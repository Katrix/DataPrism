<!DOCTYPE html><html data-githubContributorsUrl="https://api.github.com/repos/Katrix/DataPrism" data-githubContributorsFilename="docs/_docs/guide/01_table_definitions.md" data-pathToRoot=""><head><meta charset="utf-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"></meta><title>Table definitions</title><link rel="shortcut icon" type="image/x-icon" href="favicon.ico"></link><script type="text/javascript" src="scripts/theme.js"></script><script type="text/javascript" src="scripts/searchData.js" defer="true"></script><script type="text/javascript" src="scripts/scastieConfiguration.js" defer="true"></script><link rel="stylesheet" href="styles/theme/bundle.css"></link><link rel="stylesheet" href="styles/theme/components/bundle.css"></link><link rel="stylesheet" href="styles/theme/components/button/bundle.css"></link><link rel="stylesheet" href="styles/theme/layout/bundle.css"></link><link rel="stylesheet" href="styles/nord-light.css"></link><link rel="stylesheet" href="styles/dotty-icons.css"></link><link rel="stylesheet" href="styles/filter-bar.css"></link><link rel="stylesheet" href="styles/code-snippets.css"></link><link rel="stylesheet" href="styles/searchbar.css"></link><link rel="stylesheet" href="styles/social-links.css"></link><link rel="stylesheet" href="styles/versions-dropdown.css"></link><link rel="stylesheet" href="styles/content-contributors.css"></link><link rel="stylesheet" href="styles/fontawesome.css"></link><script type="text/javascript" src="hljs/highlight.pack.js" defer="true"></script><script type="text/javascript" src="scripts/hljs-scala3.js" defer="true"></script><script type="text/javascript" src="scripts/ux.js" defer="true"></script><script type="text/javascript" src="scripts/common/component.js" defer="true"></script><script type="text/javascript" src="scripts/common/utils.js" defer="true"></script><script type="text/javascript" src="scripts/components/FilterBar.js" defer="true"></script><script type="text/javascript" src="scripts/components/DocumentableList.js" defer="true"></script><script type="text/javascript" src="scripts/components/Input.js" defer="true"></script><script type="text/javascript" src="scripts/components/FilterGroup.js" defer="true"></script><script type="text/javascript" src="scripts/components/Filter.js" defer="true"></script><script type="text/javascript" src="scripts/scaladoc-scalajs.js" defer="true"></script><script type="text/javascript" src="scripts/contributors.js" defer="true"></script><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" defer="true"></script><script type="text/javascript" src="https://d3js.org/d3.v6.min.js" defer="true"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/graphlib-dot@0.6.2/dist/graphlib-dot.min.js" defer="true"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js" defer="true"></script><script type="text/javascript" src="https://scastie.scala-lang.org/embedded.js" defer="true"></script><script type="text/javascript" src="scripts/data.js" defer="true"></script><link rel="stylesheet" href="styles/staticsitestyles.css"></link><script>var pathToRoot = "";</script></head><body><div id=""><div id="header" class="body-small"><div class="header-container-left"><a href="" class="logo-container"><span class="project-name h300">DataPrism</span></a><span onclick="dropdownHandler(event)" class="text-button with-arrow" id="dropdown-trigger"><a><div class="projectVersion">0.0.0+46-3e3dd803-SNAPSHOT</div></a></span><div id="version-dropdown" class="dropdown-menu"></div></div><div class="header-container-right"><button id="search-toggle" class="icon-button"></button><span id="theme-toggle" class="icon-button"></span><span id="mobile-menu-toggle" class="icon-button hamburger"></span></div></div><div id="mobile-menu"><div class="mobile-menu-header body-small"><span class="mobile-menu-logo"><span class="project-name h300">DataPrism</span></span><button id="mobile-menu-close" class="icon-button close"></button></div><div class="mobile-menu-container body-medium"><input id="mobile-scaladoc-searchbar-input" class="scaladoc-searchbar-input" type="search" placeholder="Find anything"></input><span id="mobile-theme-toggle" class="mobile-menu-item mode"></span></div></div><span id="mobile-sidebar-toggle" class="floating-button"></span><div id="leftColumn" class="body-small"><div class="switcher-container"><a id="docs-nav-button" class="switcher h100 selected" href="index.html">Docs</a><a id="api-nav-button" class="switcher h100 " href="api/index.html">API</a></div><nav id="docs-nav" class="side-menu"><div class="ni n0 expanded"><span class="nh h100 selected de"><a href="#"><span>Table definitions</span></a></span></div><div class="ni n0 "><span class="nh de"><a href="02_queries.html"><span>Queries</span></a></span></div><div class="ni n0 "><span class="nh de"><a href="03_operations.html"><span>Operations (SELECT, INSERT, UPDATE, DELETE)</span></a></span></div><div class="ni n0 "><span class="nh de"><a href="04_types.html"><span>Types</span></a></span></div><div class="ni n0 "><span class="nh de"><a href="05_dbvalue_expressions.html"><span>DbValue and Expressions</span></a></span></div><div class="ni n0 "><span class="nh de"><a href="06_compiled.html"><span>Compiled queries and commands</span></a></span></div><div class="ni n0 "><span class="nh de"><a href="07_mapres_exotic_data.html"><span>MapRes and Exotic data</span></a></span></div><div class="ni n0 "><span class="nh de"><a href="08_transactions.html"><span>Transactions</span></a></span></div><div class="ni n0 "><span class="nh de"><a href="09_cats_effects.html"><span>Usage with Cats effects</span></a></span></div><div class="ni n0 "><span class="nh de"><a href="10_fs2_effects.html"><span>Usage with Fs2</span></a></span></div><div class="ni n0 "><span class="nh de"><a href="11_skunk.html"><span>Usage with Skunk</span></a></span></div></nav></div><div id="footer" class="body-small"><div class="left-container">Generated with</div><div class="right-container"><a href="https://github.com/Katrix/DataPrism"><button class="icon-button gh"></button></a><div class="text"></div></div><div class="text-mobile"></div></div><div id="scaladoc-searchBar"></div><div id="main"><div class="breadcrumbs container"><a href="index.html">DataPrism</a>/<a href="01_table_definitions.html">Table definitions</a></div><div id="content" class="body-medium"><div><section id="table-definitions-1"> 
 <h1 class="h500"><a href="#table-definitions-1" class="anchor"></a>Table definitions</h1> 
 <p>The first thing you need when using DataPrism is a description of the table you are querying. In the vast amount of cases, you will express this using a Higher Kinded Data (HKD) structure. HKD is a normal <code>case class</code> where the type of each field is wrapped in a higher kinded type.</p> 
 <p>Here's an example of a HKD structure.</p> 
 <div class="snippet mono-small-block" scala-snippet="" runnable=""> 
  <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>case class UserK[F[_]](
</span><span line-number="2" class=""><span class="tooltip-container"></span>  id: F[Int],
</span><span line-number="3" class=""><span class="tooltip-container"></span>  name: F[Option[String]],
</span><span line-number="4" class=""><span class="tooltip-container"></span>  username: F[String],
</span><span line-number="5" class=""><span class="tooltip-container"></span>  email: F[String]
</span><span line-number="6" class=""><span class="tooltip-container"></span>)
</span></code></pre> 
  <div class="snippet-meta"> 
   <div class="snippet-label">
     User.scala 
   </div> 
  </div> 
  <div class="buttons"></div> 
 </div> 
 <p>You also need instances of <a href="https://perspective.katsstuff.net/api/perspective/ApplyK.html"><code>perspective.ApplyKC</code></a> and <a href="https://perspective.katsstuff.net/api/perspective/TraverseK$.html"><code>perspective.TraverseKC</code></a> for the HKD. (Eventually you'll just be able to use a derive clause for this, but for now you have to call a macro manually.)</p> 
 <div class="snippet mono-small-block" scala-snippet="" runnable=""> 
  <pre><code class="language-scala"><span line-number="1" class="hideable include"><span class="tooltip-container"></span>case class UserK[F[_]](
</span><span line-number="2" class="hideable include"><span class="tooltip-container"></span>  id: F[Int],
</span><span line-number="3" class="hideable include"><span class="tooltip-container"></span>  name: F[Option[String]],
</span><span line-number="4" class="hideable include"><span class="tooltip-container"></span>  username: F[String],
</span><span line-number="5" class="hideable include"><span class="tooltip-container"></span>  email: F[String]
</span><span line-number="6" class="hideable include"><span class="tooltip-container"></span>)
</span><span line-number="7" class="hideable include"><span class="tooltip-container"></span>
</span><span line-number="8" class=""><span class="tooltip-container"></span>import dataprism.KMacros
</span><span line-number="9" class=""><span class="tooltip-container"></span>
</span><span line-number="10" class=""><span class="tooltip-container"></span>// Snippet compiler fails here sadly
</span><span line-number="11" class=""><span class="tooltip-container"></span>given KMacros.ApplyTraverseKC[UserK] = ??? // KMacros.deriveApplyTraverseKC[UserK]
</span></code></pre> 
  <div class="snippet-meta"> 
   <div class="snippet-label">
     UserInstance.scala 
   </div> 
  </div> 
  <div class="buttons"></div> 
 </div> 
 <p>Lastly you need the table definition itself, an instance of <code>Table[Codec, UserK]</code>. <code>Codec</code> here represents how data is read from and written to the database. The codec you use depends on how you connect to the database. Currently, there are two options: JDBC and Skunk. Depending on your choice, you'll use different database codecs. Unless specified otherwise, these docs will assume JDBC is being used.</p> 
 <p><code>Table</code> itself takes two parameters. The name of the table, and a value of type <code>UserK[Column]</code>. <code>Column</code> meanwhile takes two parameters, the name and the type of the column. The types can be gotten from an object that corresponds to the database you're using in <code>dataprism.jdbc.sql.&lt;db choice&gt;JdbcTypes</code>. For these docs, Postgres will be used.</p> 
 <p>Here is how a table definition could look like for the HKD above.</p> 
 <div class="snippet mono-small-block" scala-snippet="" runnable=""> 
  <pre><code class="language-scala"><span line-number="1" class="hideable include"><span class="tooltip-container"></span>case class UserK[F[_]](
</span><span line-number="2" class="hideable include"><span class="tooltip-container"></span>  id: F[Int],
</span><span line-number="3" class="hideable include"><span class="tooltip-container"></span>  name: F[Option[String]],
</span><span line-number="4" class="hideable include"><span class="tooltip-container"></span>  username: F[String],
</span><span line-number="5" class="hideable include"><span class="tooltip-container"></span>  email: F[String]
</span><span line-number="6" class="hideable include"><span class="tooltip-container"></span>)
</span><span line-number="7" class="hideable include"><span class="tooltip-container"></span>
</span><span line-number="8" class="hideable include"><span class="tooltip-container"></span>import dataprism.KMacros
</span><span line-number="9" class="hideable include"><span class="tooltip-container"></span>
</span><span line-number="10" class="hideable include"><span class="tooltip-container"></span>// Snippet compiler fails here sadly
</span><span line-number="11" class="hideable include"><span class="tooltip-container"></span>given KMacros.ApplyTraverseKC[UserK] = ??? // KMacros.deriveApplyTraverseKC[UserK]
</span><span line-number="12" class="hideable include"><span class="tooltip-container"></span>
</span><span line-number="13" class=""><span class="tooltip-container"></span>import dataprism.sql.{Table, Column}
</span><span line-number="14" class=""><span class="tooltip-container"></span>import dataprism.jdbc.sql.JdbcCodec
</span><span line-number="15" class=""><span class="tooltip-container"></span>import dataprism.jdbc.sql.PostgresJdbcTypes.*
</span><span line-number="16" class=""><span class="tooltip-container"></span>
</span><span line-number="17" class=""><span class="tooltip-container"></span>val table: Table[JdbcCodec, UserK] = Table(
</span><span line-number="18" class=""><span class="tooltip-container"></span>  "users",
</span><span line-number="19" class=""><span class="tooltip-container"></span>  UserK(
</span><span line-number="20" class=""><span class="tooltip-container"></span>    Column("id", integer),
</span><span line-number="21" class=""><span class="tooltip-container"></span>    Column("name", text.nullable),
</span><span line-number="22" class=""><span class="tooltip-container"></span>    Column("username", text),
</span><span line-number="23" class=""><span class="tooltip-container"></span>    Column("email", text)
</span><span line-number="24" class=""><span class="tooltip-container"></span>  )
</span><span line-number="25" class=""><span class="tooltip-container"></span>)
</span></code></pre> 
  <div class="buttons"></div> 
 </div> 
 <p>Notice that all database types have to be written out by hand. This is by design, and a similar approach is taken elsewhere in DataPrism. These types are never inferred. You have to specify them.</p> 
 <p>Putting it all together, the table definition could look like this.</p> 
 <div class="snippet mono-small-block" scala-snippet="" runnable=""> 
  <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>import dataprism.KMacros
</span><span line-number="2" class=""><span class="tooltip-container"></span>import dataprism.sql.{Table, Column}
</span><span line-number="3" class=""><span class="tooltip-container"></span>import dataprism.jdbc.sql.JdbcCodec
</span><span line-number="4" class=""><span class="tooltip-container"></span>import dataprism.jdbc.sql.PostgresJdbcTypes.*
</span><span line-number="5" class=""><span class="tooltip-container"></span>
</span><span line-number="6" class=""><span class="tooltip-container"></span>case class UserK[F[_]](
</span><span line-number="7" class=""><span class="tooltip-container"></span>  id: F[Int],
</span><span line-number="8" class=""><span class="tooltip-container"></span>  name: F[Option[String]],
</span><span line-number="9" class=""><span class="tooltip-container"></span>  username: F[String],
</span><span line-number="10" class=""><span class="tooltip-container"></span>  email: F[String]
</span><span line-number="11" class=""><span class="tooltip-container"></span>)
</span><span line-number="12" class=""><span class="tooltip-container"></span>
</span><span line-number="13" class=""><span class="tooltip-container"></span>object UserK:
</span><span line-number="14" class=""><span class="tooltip-container"></span>  // Snippet compiler fails here sadly
</span><span line-number="15" class=""><span class="tooltip-container"></span>  given KMacros.ApplyTraverseKC[UserK] = ??? // KMacros.deriveApplyTraverseKC[UserK]
</span><span line-number="16" class=""><span class="tooltip-container"></span>
</span><span line-number="17" class=""><span class="tooltip-container"></span>  val table: Table[JdbcCodec, UserK] = Table(
</span><span line-number="18" class=""><span class="tooltip-container"></span>    "users",
</span><span line-number="19" class=""><span class="tooltip-container"></span>    UserK(
</span><span line-number="20" class=""><span class="tooltip-container"></span>      Column("id", integer),
</span><span line-number="21" class=""><span class="tooltip-container"></span>      Column("name", text.nullable),
</span><span line-number="22" class=""><span class="tooltip-container"></span>      Column("username", text),
</span><span line-number="23" class=""><span class="tooltip-container"></span>      Column("email", text)
</span><span line-number="24" class=""><span class="tooltip-container"></span>    )
</span><span line-number="25" class=""><span class="tooltip-container"></span>  )
</span></code></pre> 
  <div class="buttons"></div> 
 </div> 
</section> 
<section id="nesting-1"> 
 <h2 class="h500"><a href="#nesting-1" class="anchor"></a>Nesting</h2> 
 <p>Nesting HKD is completely fine, as long as you derive instances for <code>ApplyKC</code> and <code>TraverseKC</code> for all the fields.</p> 
 <div class="snippet mono-small-block" scala-snippet="" runnable=""> 
  <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>import dataprism.KMacros
</span><span line-number="2" class=""><span class="tooltip-container"></span>
</span><span line-number="3" class=""><span class="tooltip-container"></span>case class OuterK[F[_]](
</span><span line-number="4" class=""><span class="tooltip-container"></span>  a: F[Int],
</span><span line-number="5" class=""><span class="tooltip-container"></span>  b: F[String],
</span><span line-number="6" class=""><span class="tooltip-container"></span>  inner: OuterK.InnerK[F]
</span><span line-number="7" class=""><span class="tooltip-container"></span>)
</span><span line-number="8" class=""><span class="tooltip-container"></span>
</span><span line-number="9" class=""><span class="tooltip-container"></span>object OuterK:
</span><span line-number="10" class=""><span class="tooltip-container"></span>  given KMacros.ApplyTraverseKC[OuterK] = ??? // KMacros.deriveApplyTraverseKC[OuterK]
</span><span line-number="11" class=""><span class="tooltip-container"></span>
</span><span line-number="12" class=""><span class="tooltip-container"></span>  case class InnerK[F[_]](
</span><span line-number="13" class=""><span class="tooltip-container"></span>    c: F[Double]
</span><span line-number="14" class=""><span class="tooltip-container"></span>  )
</span><span line-number="15" class=""><span class="tooltip-container"></span>
</span><span line-number="16" class=""><span class="tooltip-container"></span>  object InnerK:
</span><span line-number="17" class=""><span class="tooltip-container"></span>    given KMacros.ApplyTraverseKC[InnerK] = ??? // KMacros.deriveApplyTraverseKC[InnerK]
</span></code></pre> 
  <div class="buttons"></div> 
 </div> 
</section> 
<section id="autoderiving-table-instances-1"> 
 <h2 class="h500"><a href="#autoderiving-table-instances-1" class="anchor"></a>Autoderiving table instances</h2> 
 <p>There is also some experimental support for deriving <code>Table</code> instances automatically. Column names are taken from the name of a field or from an annotation, while column types are gotten from the type of the field or an annotation. If the SQL types are gotten from the types of the field, you have to define the field type as <code>jdbcType.T</code>. Here is an example:</p> 
 <div class="snippet mono-small-block" scala-snippet="" runnable=""> 
  <pre><code class="language-scala"><span line-number="1" class=""><span class="tooltip-container"></span>import dataprism.KMacros
</span><span line-number="2" class=""><span class="tooltip-container"></span>import dataprism.sql.{named, Table}
</span><span line-number="3" class=""><span class="tooltip-container"></span>import dataprism.jdbc.sql.{JdbcCodec, JdbcColumns, jdbcType}
</span><span line-number="4" class=""><span class="tooltip-container"></span>import dataprism.jdbc.sql.PostgresJdbcTypes.*
</span><span line-number="5" class=""><span class="tooltip-container"></span>
</span><span line-number="6" class=""><span class="tooltip-container"></span>case class AutoDerivedTableK[F[_]](
</span><span line-number="7" class=""><span class="tooltip-container"></span>  foo: F[text.T],
</span><span line-number="8" class=""><span class="tooltip-container"></span>  bar: F[integer.nullable.T],
</span><span line-number="9" class=""><span class="tooltip-container"></span>  @jdbcType(boolean) baz: F[Boolean],
</span><span line-number="10" class=""><span class="tooltip-container"></span>  @named("bin") @jdbcType(doublePrecision) abc: F[Double]
</span><span line-number="11" class=""><span class="tooltip-container"></span>) //derives JdbcColumns //// Snippet compiler fails here sadly
</span><span line-number="12" class=""><span class="tooltip-container"></span>object AutoDerivedTable:
</span><span line-number="13" class=""><span class="tooltip-container"></span>  given KMacros.ApplyTraverseKC[AutoDerivedTableK] = ??? // KMacros.deriveApplyTraverseKC[AutoDerivedTableK]
</span><span line-number="14" class=""><span class="tooltip-container"></span>  
</span><span line-number="15" class=""><span class="tooltip-container"></span>  //Can't call because snipper compiler failed
</span><span line-number="16" class=""><span class="tooltip-container"></span>  //val table: Table[JdbcCodec, AutoDerivedTableK] = JdbcColumns.table("auto_table")
</span></code></pre> 
  <div class="buttons"></div> 
 </div> 
</section></div><div id="toc" class="body-small"><div id="toc-container"><span class="toc-title h200">In this article</span><nav class="toc-nav"><ul class="toc-list"><li><a href="#table-definitions-1">Table definitions</a><ul><li><a href="#nesting-1">Nesting</a></li><li><a href="#autoderiving-table-instances-1">Autoderiving table instances</a></li></ul></li></ul></nav></div></div></div><div id="footer" class="body-small mobile-footer"><div class="left-container">Generated with</div><div class="right-container"><a href="https://github.com/lampepfl/dotty"><button class="icon-button gh"></button></a><a href="https://twitter.com/scala_lang"><button class="icon-button twitter"></button></a><a href="https://discord.com/invite/scala"><button class="icon-button discord"></button></a><a href="https://gitter.im/scala/scala"><button class="icon-button gitter"></button></a><div class="text"></div></div><div class="text-mobile"></div></div></div></div></body></html>